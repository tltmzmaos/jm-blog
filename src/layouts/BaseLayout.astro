---
import SEO from '../components/SEO.astro';

export interface Props {
  title: string;
  description?: string;
  image?: string;
  type?: 'website' | 'article';
  publishedTime?: string;
  modifiedTime?: string;
  tags?: string[];
  author?: string;
  hasMath?: boolean;
}

const {
  title,
  description = "Jongmin's Dev Blog",
  image = "/og-image.jpg",
  type = "website",
  publishedTime,
  modifiedTime,
  tags,
  author,
  hasMath = false
} = Astro.props;
---

<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="icon" type="image/svg+xml" href="/favicon.svg" />
    <link rel="apple-touch-icon" href="/logo.svg" />
    <meta name="generator" content={Astro.generator} />
    <meta name="color-scheme" content="light dark" />
    <meta name="theme-color" content="#ffffff" media="(prefers-color-scheme: light)" />
    <meta name="theme-color" content="#1e1e1e" media="(prefers-color-scheme: dark)" />

    <!-- DNS Prefetch for external resources -->
    <link rel="dns-prefetch" href="https://fonts.googleapis.com" />
    <link rel="dns-prefetch" href="https://fonts.gstatic.com" />
    <link rel="dns-prefetch" href="https://cdn.jsdelivr.net" />

    <!-- Font with display swap for better performance -->
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      id="google-fonts"
      href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap"
      rel="stylesheet"
      media="print"
    />
    <script is:inline>
      document.getElementById('google-fonts').onload = function() {
        this.media = 'all';
      };
    </script>
    <noscript>
      <link
        href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap"
        rel="stylesheet"
      />
    </noscript>

    <!-- SEO -->
    <SEO
      title={title}
      description={description}
      image={image}
      type={type}
      publishedTime={publishedTime}
      modifiedTime={modifiedTime}
      tags={tags}
      author={author}
    />

    <!-- KaTeX CSS (only loaded on pages with math) -->
    {hasMath && (
      <link
        rel="stylesheet"
        href="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.css"
        crossorigin="anonymous"
      />
    )}

    <title>{title}</title>

    <!-- Prevent dark mode flash -->
    <script is:inline>
      (function() {
        const theme = localStorage.getItem('theme');
        const prefersDark = window.matchMedia('(prefers-color-scheme: dark)').matches;

        if (theme === 'dark' || (!theme && prefersDark)) {
          document.documentElement.classList.add('dark');
          document.documentElement.style.colorScheme = 'dark';
        }

        window.matchMedia('(prefers-color-scheme: dark)').addEventListener('change', (e) => {
          if (!localStorage.getItem('theme')) {
            document.documentElement.classList.toggle('dark', e.matches);
            document.documentElement.style.colorScheme = e.matches ? 'dark' : 'light';
          }
        });
      })();
    </script>
  </head>

  <body>
    <slot />
  </body>
</html>

<style is:global>
  * {
    margin: 0;
    padding: 0;
    box-sizing: border-box;
  }

  :root {
    --color-bg: #ffffff;
    --color-bg-secondary: #f5f5f5;
    --color-bg-tertiary: #fafafa;
    --color-text: #1a1a1a;
    --color-text-secondary: #666666;
    --color-text-muted: #888888;
    --color-border: #e5e5e5;
    --color-border-light: #f0f0f0;
    --color-accent: #0066ff;
    --color-accent-hover: #0052cc;
    --color-code-bg: #1e1e1e;
    --color-code-border: #3c3c3c;
  }

  .dark {
    --color-bg: #1e1e1e;
    --color-bg-secondary: #252526;
    --color-bg-tertiary: #2a2d2e;
    --color-text: #d4d4d4;
    --color-text-secondary: #808080;
    --color-text-muted: #888888;
    --color-border: #3c3c3c;
    --color-border-light: #333333;
    --color-accent: #58a6ff;
    --color-accent-hover: #79b8ff;
    --color-code-bg: #1e1e1e;
    --color-code-border: #3c3c3c;
  }

  html {
    scroll-behavior: smooth;
  }

  body {
    font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
    -webkit-font-smoothing: antialiased;
    -moz-osx-font-smoothing: grayscale;
    background: var(--color-bg);
    color: var(--color-text);
    line-height: 1.6;
    transition: background-color 0.2s ease, color 0.2s ease;
  }

  /* Dark mode transition animation */
  .theme-transition,
  .theme-transition *,
  .theme-transition *::before,
  .theme-transition *::after {
    transition: background-color 0.2s ease, color 0.2s ease, border-color 0.2s ease, fill 0.2s ease, stroke 0.2s ease !important;
  }

  a {
    color: inherit;
    text-decoration: none;
  }

  img {
    max-width: 100%;
    height: auto;
  }

  /* Selection styles */
  ::selection {
    background: var(--color-accent);
    color: #fff;
  }

  .dark ::selection {
    background: #264f78;
    color: #ffffff;
  }

  /* Focus styles */
  :focus-visible {
    outline: 2px solid var(--color-accent);
    outline-offset: 2px;
  }

  /* Scrollbar */
  ::-webkit-scrollbar {
    width: 8px;
    height: 8px;
  }

  ::-webkit-scrollbar-track {
    background: var(--color-bg-secondary);
  }

  ::-webkit-scrollbar-thumb {
    background: #ccc;
    border-radius: 4px;
  }

  ::-webkit-scrollbar-thumb:hover {
    background: #999;
  }

  .dark ::-webkit-scrollbar-thumb {
    background: var(--color-border);
  }

  .dark ::-webkit-scrollbar-thumb:hover {
    background: #4f4f4f;
  }

  /* Code blocks */
  .dark pre[class*="language-"],
  .dark .shiki {
    background: #1e1e1e !important;
    border: 1px solid #3c3c3c !important;
  }

  .dark code[class*="language-"],
  .dark .shiki code {
    color: #d4d4d4 !important;
  }

  /* Reduced motion preference */
  @media (prefers-reduced-motion: reduce) {
    *, *::before, *::after {
      animation-duration: 0.01ms !important;
      transition-duration: 0.01ms !important;
      scroll-behavior: auto !important;
    }
  }
</style>
