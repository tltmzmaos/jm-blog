---
---

<script>
  // @ts-nocheck
  document.addEventListener('DOMContentLoaded', () => {
    // 키보드 단축키 처리
    document.addEventListener('keydown', (e) => {
      // Ctrl/Cmd + K: 검색창 포커스
      if ((e.ctrlKey || e.metaKey) && e.key === 'k') {
        e.preventDefault();
        const searchInput = document.getElementById('search-input');
        if (searchInput) {
          searchInput.focus();
          searchInput.select();
        }
      }
      
      // Escape: 검색 결과 닫기
      if (e.key === 'Escape') {
        const searchResults = document.getElementById('search-results');
        if (searchResults && !searchResults.classList.contains('hidden')) {
          searchResults.classList.add('hidden');
          document.getElementById('search-input')?.blur();
        }
      }
      
      // G + H: 홈으로 이동
      if (e.key === 'g' && !e.ctrlKey && !e.metaKey && !e.altKey) {
        setTimeout(() => {
          document.addEventListener('keydown', function homeHandler(e2) {
            if (e2.key === 'h') {
              window.location.href = '/';
            }
            document.removeEventListener('keydown', homeHandler);
          }, { once: true });
        }, 0);
      }
      
      // T: 다크모드 토글
      if (e.key === 't' && !e.ctrlKey && !e.metaKey && !e.altKey && !isInputFocused()) {
        const themeToggle = document.getElementById('theme-toggle');
        if (themeToggle) {
          themeToggle.click();
        }
      }
    });

    // 입력 필드에 포커스가 있는지 확인
    function isInputFocused() {
      const activeElement = document.activeElement;
      return activeElement && (
        activeElement.tagName === 'INPUT' ||
        activeElement.tagName === 'TEXTAREA' ||
        activeElement.contentEditable === 'true'
      );
    }

    // 키보드 단축키 도움말 표시
    function showKeyboardHelp() {
      const helpModal = document.createElement('div');
      helpModal.className = 'fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50';
      helpModal.innerHTML = `
        <div class="bg-white dark:bg-dark-surface rounded-lg p-6 max-w-md mx-4 shadow-xl">
          <div class="flex items-center justify-between mb-4">
            <h3 class="text-lg font-semibold text-gray-900 dark:text-dark-text">Keyboard Shortcuts</h3>
            <button onclick="this.closest('.fixed').remove()" class="text-gray-400 hover:text-gray-600 dark:hover:text-gray-300">
              <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
              </svg>
            </button>
          </div>
          <div class="space-y-3 text-sm">
            <div class="flex justify-between">
              <span class="text-gray-600 dark:text-gray-400">Search</span>
              <kbd class="px-2 py-1 bg-gray-100 dark:bg-gray-700 rounded text-xs">Ctrl + K</kbd>
            </div>
            <div class="flex justify-between">
              <span class="text-gray-600 dark:text-gray-400">Go to Home</span>
              <kbd class="px-2 py-1 bg-gray-100 dark:bg-gray-700 rounded text-xs">G + H</kbd>
            </div>
            <div class="flex justify-between">
              <span class="text-gray-600 dark:text-gray-400">Toggle Theme</span>
              <kbd class="px-2 py-1 bg-gray-100 dark:bg-gray-700 rounded text-xs">T</kbd>
            </div>
            <div class="flex justify-between">
              <span class="text-gray-600 dark:text-gray-400">Close/Escape</span>
              <kbd class="px-2 py-1 bg-gray-100 dark:bg-gray-700 rounded text-xs">Esc</kbd>
            </div>
            <div class="flex justify-between">
              <span class="text-gray-600 dark:text-gray-400">Show this help</span>
              <kbd class="px-2 py-1 bg-gray-100 dark:bg-gray-700 rounded text-xs">?</kbd>
            </div>
          </div>
        </div>
      `;
      
      document.body.appendChild(helpModal);
      
      // ESC로 닫기
      helpModal.addEventListener('keydown', (e) => {
        if (e.key === 'Escape') {
          helpModal.remove();
        }
      });
      
      // 배경 클릭으로 닫기
      helpModal.addEventListener('click', (e) => {
        if (e.target === helpModal) {
          helpModal.remove();
        }
      });
    }

    // ? 키로 도움말 표시
    document.addEventListener('keydown', (e) => {
      if (e.key === '?' && !isInputFocused()) {
        e.preventDefault();
        showKeyboardHelp();
      }
    });

    // 접근성 개선: 포커스 표시
    document.addEventListener('keydown', (e) => {
      if (e.key === 'Tab') {
        document.body.classList.add('keyboard-navigation');
      }
    });

    document.addEventListener('mousedown', () => {
      document.body.classList.remove('keyboard-navigation');
    });
  });
</script>

<style>
  /* 키보드 네비게이션 시에만 포커스 표시 */
  .keyboard-navigation *:focus {
    outline: 2px solid #3b82f6 !important;
    outline-offset: 2px !important;
  }
  
  /* 기본 상태에서는 포커스 아웃라인 숨김 */
  *:focus {
    outline: none;
  }
  
  /* 키보드 단축키 표시 */
  kbd {
    font-family: ui-monospace, SFMono-Regular, "SF Mono", Consolas, "Liberation Mono", Menlo, monospace;
    font-size: 0.75rem;
    font-weight: 600;
    line-height: 1;
    color: #374151;
    background-color: #f3f4f6;
    border: 1px solid #d1d5db;
    border-radius: 0.25rem;
    padding: 0.25rem 0.5rem;
  }
  
  .dark kbd {
    color: #d1d5db;
    background-color: #374151;
    border-color: #4b5563;
  }
</style>