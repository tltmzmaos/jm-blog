---
export interface Props {
  title: string;
  description: string;
  pubDate: Date;
  heroImage?: string;
  slug: string;
  tags?: string[];
}

const { title, description, pubDate, heroImage, slug, tags = [] } = Astro.props;
const MAX_VISIBLE_TAGS = 2;
const visibleTags = tags.slice(0, MAX_VISIBLE_TAGS);
const remainingCount = tags.length - MAX_VISIBLE_TAGS;

const baseUrl = import.meta.env.BASE_URL;
const formattedDate = new Intl.DateTimeFormat('en-US', {
  year: 'numeric',
  month: 'short',
  day: 'numeric'
}).format(pubDate);
---

<article class="post-item">
  <a href={`${baseUrl}posts/${slug}`} class="post-link">
    {heroImage && (
      <div class="thumbnail">
        <img
          src={heroImage}
          alt=""
          loading="lazy"
          decoding="async"
          width="120"
          height="68"
        />
      </div>
    )}

    <div class="content">
      <h2 class="title">{title}</h2>
      <p class="description">{description}</p>

      <div class="meta">
        <time datetime={pubDate.toISOString()}>{formattedDate}</time>
        {tags.length > 0 && (
          <div class="tags">
            {visibleTags.map(tag => (
              <span class="tag">{tag}</span>
            ))}
            {remainingCount > 0 && (
              <span class="tag tag-more">+{remainingCount}</span>
            )}
          </div>
        )}
      </div>
    </div>
  </a>
</article>

<style>
  .post-item {
    border-bottom: 1px solid #e5e5e5;
  }

  :global(.dark) .post-item {
    border-bottom-color: #333;
  }

  .post-link {
    display: flex;
    gap: 1.25rem;
    padding: 1.25rem 0;
    text-decoration: none;
    transition: opacity 0.15s;
  }

  .post-link:hover {
    opacity: 0.75;
  }

  .thumbnail {
    flex-shrink: 0;
    width: 140px;
    height: 90px;
    border-radius: 6px;
    overflow: hidden;
  }

  :global(.dark) .thumbnail {
  }

  .thumbnail img {
    width: 100%;
    height: 100%;
    object-fit: cover;
    object-position: center top;
  }

  .content {
    flex: 1;
    min-width: 0;
    display: flex;
    flex-direction: column;
    justify-content: center;
    gap: 0.25rem;
  }

  .title {
    font-size: 1.0625rem;
    font-weight: 600;
    color: #1a1a1a;
    margin: 0;
    line-height: 1.4;
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
  }

  :global(.dark) .title {
    color: #f0f0f0;
  }

  .description {
    font-size: 0.875rem;
    color: #666;
    margin: 0;
    line-height: 1.5;
    display: -webkit-box;
    -webkit-line-clamp: 2;
    -webkit-box-orient: vertical;
    overflow: hidden;
  }

  :global(.dark) .description {
    color: #888;
  }

  .meta {
    display: flex;
    align-items: center;
    gap: 0.75rem;
    font-size: 0.8125rem;
    color: #888;
    margin-top: auto;
  }

  .tags {
    display: flex;
    gap: 0.375rem;
  }

  .tag {
    padding: 0.125rem 0.5rem;
    font-size: 0.6875rem;
    background: #f0f0f0;
    color: #666;
    border-radius: 4px;
    white-space: nowrap;
  }

  :global(.dark) .tag {
    background: #2a2a2a;
    color: #888;
  }

  .tag-more {
    background: #e8e8e8;
    color: #666;
  }

  :global(.dark) .tag-more {
    background: #333;
    color: #888;
  }

  @media (max-width: 640px) {
    .post-link {
      gap: 0.875rem;
    }

    .thumbnail {
      width: 112px;
      height: 72px;
    }

    .title {
      font-size: 0.9375rem;
    }

    .description {
      -webkit-line-clamp: 1;
    }

    .meta {
      flex-wrap: wrap;
      gap: 0.5rem;
    }

    .tags {
      width: 100%;
    }

    .tag {
      font-size: 0.625rem;
    }
  }
</style>
